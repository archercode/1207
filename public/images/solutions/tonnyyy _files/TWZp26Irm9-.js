/*!CK:1926344406!*//*1433730428,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KanRJ"]); }

__d("PageVoiceDropdownSelector.react",["AdsAssetSectionType","AdsLoadState","AdsPageAssetSelector.react","BizSiteIdentifier.brands","BusinessAssetGrouping.brands","Image.react","ImageBlock.react","LayerHideOnBlur","LayerHideOnEscape","React","ReactLayeredComponentMixin","XUIContextualDialog.react","XUIPopoverButton.react","underscore.ads","cx","emptyFunction","fbt","invariant","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();'use strict';var z=p,aa=z.PropTypes,ba=300,ca=12,da=p.createClass({displayName:"PageVoiceDropdownSelector",propTypes:{covered:aa.bool,permissions:aa.object,pages:aa.object.isRequired,selectedActorID:aa.string,showBusinessPages:aa.bool,showPersonalPageInRoot:aa.bool,showPageName:aa.bool,showUserInPersonalVoices:aa.bool,suppressed:aa.bool.isRequired,user:aa.object.isRequired,onChange:aa.func.isRequired,onClick:aa.func.isRequired},mixins:[q],getDefaultProps:function(){return {searchBarVisible:false,showBusinessPages:true,showPageName:false,showUserInPersonalVoices:true,covered:true};},getInitialState:function(){var ea=k.NULL_BIZ_ID;if(this.props.pages[this.props.selectedActorID]&&this.props.pages[this.props.selectedActorID].businessID)ea=""+this.props.pages[this.props.selectedActorID].businessID;var fa=ea;if(!j.isBizSite())fa=null;return {dialogShown:false,defaultBusinessID:fa,textDisplay:this._getActorName(this.props.selectedActorID),selectedActorID:this.props.selectedActorID,selectedBusinessID:ea,searchQuery:"",shownBusinessID:fa};},componentWillReceiveProps:function(ea){this.setState({selectedActorID:ea.selectedActorID});},renderLayers:function(){return {contextualDialog:p.createElement(r,{contextRef:function(){return this.refs['open-menu-button'];}.bind(this),ref:"selector-dialog",shown:this.state.dialogShown,position:"below",alignment:"right",behaviors:{LayerHideOnBlur:n,LayerHideOnEscape:o},onToggle:this._onToggle},this._renderLayerContent())};},render:function(){return (p.createElement(s,{className:"_4z8-",haschevron:!this.props.covered,image:p.createElement(l,{width:16,height:16,src:this.props.covered?y('images/pages/voice/flag.png'):this._getSelectedImageSource()}),label:this.props.showPageName?this._getSelectedActorName():"",ref:"open-menu-button",suppressed:this.props.suppressed,type:"button",onClick:this._onToggleDialogClick}));},_renderLayerContent:function(){if(t.isEmpty(this.props.user))return null;var ea=this._getPageSelectorPages(),fa=null;if(this.props.selectedActorID===this.props.user.id)fa=(p.createElement("div",{className:"_55fc"}));var ga=null;if(this.state.shownBusinessID===k.NULL_BIZ_ID||(this.state.shownBusinessID===null&&this.props.showUserInPersonalVoices))ga=(p.createElement(m,{className:(("_5dsl")+(' '+"_alf")+(this.props.selectedActorID===this.props.user.id?' '+"_2246":'')+(' '+"_alg")),onClick:function(){this._updateSelectedActor(this.props.user.id);}.bind(this)},p.createElement(l,{className:"_4-rj",width:30,height:30,src:this.props.user.thumbSrc}),p.createElement("div",{className:"_1wcv"},p.createElement("div",{className:(("_2sl4")+(' '+"_4c71"))},this.props.user.name,"Â ",p.createElement("span",{className:"_uyb"},w._("(You)")),fa))));return p.createElement("div",{className:(("_21wq")+(' '+"_70b"))},ga,p.createElement(i,{bookmarkedPages:[],compactLayout:true,listItemHoverStyle:"dark-blue",maxListHeight:ba,pages:ea,searchedPages:[],searchQuery:this.state.searchQuery,searchState:h.NOT_LOADED,selectedPageID:this.props.selectedActorID,selectedBusinessID:this.state.selectedBusinessID,selectedSectionType:g.OWNED,showBookmarks:false,showBottomBorder:false,showBusinessPages:this.props.showBusinessPages,showNonBizGroupTitle:true,showPageCount:false,showPersonalPagesInRoot:this.props.showPersonalPagesInRoot||false,showSectionPageCount:true,shownBusinessID:this.state.shownBusinessID,sortPages:false,unownedPages:[],onBusinessSelected:this._onBusinessSelected,onPageSelected:this._onPageSelected,onPageRemoved:function(){},onPageBookmarked:function(){},onSearch:this._onSearch,searchBarVisible:ea.length>=ca}));},_onBusinessSelected:function(ea){this.setState({shownBusinessID:ea});},_onPageSelected:function(ea,fa,ga){this.setState({selectedBusinessID:fa},function(){return this._updateSelectedActor(ea);}.bind(this));},_onSearch:function(ea){this.setState({searchQuery:ea});},_onToggleDialogClick:function(){this.setState({dialogShown:!this.state.dialogShown,shownBusinessID:this.state.defaultBusinessID},this.props.onClick);},_onToggle:function(ea){setTimeout(this.setState.bind(this,{dialogShown:ea},v),0);},_getSelectedImageSource:function(){var ea=this.state.selectedActorID;if(!ea)return "";if(ea===this.props.user.id){if(!this.props.user.thumbSrc)return "";return this.props.user.thumbSrc;}else{if(!this.props.pages[ea].thumbSrc)return "";return this.props.pages[ea].thumbSrc;}},_getSelectedActorName:function(){var ea=this.state.selectedActorID;if(!ea)return "";if(ea===this.props.user.id){if(!this.props.user.name)return "";return this.props.user.name;}else{if(!this.props.pages[ea].name)return "";return this.props.pages[ea].name;}},_getPageSelectorPages:function(){var ea=t.map(this.props.pages,function(fa,ga){var ha={id:ga,name:fa.name,picture:{data:{url:fa.thumbSrc}},userpermissions:{data:[]},sectionType:g.OWNED};if(fa.allBusinessData)fa.allBusinessData.forEach(function(ia){if(ia.businessID)ha.userpermissions.data.push({business:{name:ia.businessName,id:ia.businessID}});});return ha;},this);x(ea[0].id===this.props.user.id);return ea.slice(1);},_getActorName:function(ea){if(ea===this.props.user.id){return this.props.user.name;}else return this.props.pages[ea].name;},_updateSelectedActor:function(ea){if(!ea||ea===this.state.selectedActorID)return;this.setState({selectedActorID:ea,dialogShown:false,searchQuery:""});if(ea===this.props.user.id){this.setState({textDisplay:this.props.user.name});this.props.onChange({label:this.props.user.name,value:this.props.user.id});}else{this.setState({textDisplay:this.props.pages[ea].name});this.props.onChange({label:this.props.pages[ea].name,value:ea});}}});e.exports=da;},null);